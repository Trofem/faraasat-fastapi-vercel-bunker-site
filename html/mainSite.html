<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Генератор бункер (разработка)!</title>
    <style>
        body {
            background-color: #aac2f0;

        }
        .disabled {
        opacity: 0.5;
        cursor: not-allowed;
        }
        button:active, button:focus {
        border-color: gray;
        box-shadow: 0 0 5px white;
        }
        button:active {
        border-color: black;
        }
        textarea {
            border: 5px solid;
            border-image: linear-gradient(to right, #1c59ff, #6df85b) 1;
            padding: 5px;
            color: black;
            background-image: #5071af;
            background-color: transparent;
            width: 300px;
            height: 100px;
            resize: none;
            overflow: auto;
        }
        .button-blue {
            background: linear-gradient(to right, #1c59ff, #a5c4ff); 
            color: white;
            padding: 5px 15px; 
            border-radius: 50px;
        }
        .button-red {
			background: linear-gradient(to right, #ff1c1c, #ffa5a5); 
        color: white;  padding: 5px 15px; border-radius: 25px;
        }
        .button-green {
			background: linear-gradient(to right, #239c13, #6df85b); 
        color: white;  padding: 5px 15px; border-radius: 25px;
        }

    </style>
</head>
<body>
    <!-- Начальный текст -->
    <h2>Сайт по созданию персонажей для игры в бункер</h2>

    <p>На данном сайте, достаточно <b>нажать</b> на кнопку ниже и вы сможете получить сгенерированного персонажа. (В разработке)</p>
    <h2>Кнопка</h2>

    <!-- Кнопки генерации -->
    <button class="button-blue" name="createCharacterButton" onclick="getResponce('/api/character')">
        
        Создать персонажа (случайного)
    </button>
<p>
    <button class="button-blue" name="createCharacterButton" onclick="getResponce('/api/bunker')">
        
        Создать характеристики бункера (случайного)
    </button>
    </p>
    <!-- Результат -->
    <h2>Результат</h2>
    <div id="characterContainer"></div>

    <!-- Кнопка очистка текста -->
    <button class="button-red" name="clearCharacterButton" onclick="clearCharacter()" disabled>
    Очистить текст
	</button>
    
    <!-- Текстовое поле отзыва о работе -->

    <h2>Отзыв о работе сайта</h2>
    <p> <textarea name="feedbackForm" placeholder="Напишите отзыв (5 - 300 символов)"></textarea> </p>
    
    <!-- Отправить отзыв -->

    <button class="button-green" name="SendMessageButton" onclick="sendFeedback('/api/messages')" disabled>
        Отправить
    </button>

    <!-- Авторы -->

    <h2 style="color:rgb(40, 40, 250);">Создатель:</h2>
    <a style="color:rgb(57, 57, 238);" href="https://github.com/Trofem/">Trofem</a>

    <!-- пост-скриптум (: -->
    <script>
        var text_container_name = "characterContainer";
        var textarea_name = 'feedbackForm';
        function start(){
            var feedback_is_sent = false;
            var text_area = document.getElementById(textarea_name)
			DisableButtonState(true);
		}
        async function getResponce(response_url) {
            try {
                const response = await fetch(response_url);
                if (!response.ok) {
                    throw new Error(`
                    <body>
                    <p><ins>Ошибка сети при получении данных.</ins></p>
                    <p><ins>Сообщите создателю (response ${response_url} is not ok).</ins></p>
                    </body>
                    `);
                }
                const characterHtml = await response.text();
                characterText(characterHtml);
            } catch (error) {
                characterText(`Произошла ошибка: ${error.message}`);
            }
            DisableButtonState(false);
        }
        async function sendFeedback(response_url) {
            const feedback = text_area.feedback.value;
            if (feedback.lenght < 5){
                alert("Слишком короткое сообщение");
                return;
            }
            else if (feedback.lenght > 300){
                alert("Слишком длинное сообщение");
                return;
            }

            //try {
                const response = await fetch('/api/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'body': feedback
                    }
                });
                if (!response.ok) {
                    throw new Error('Failed to send feedback');
                }
                console.log('Отзыв отправлен');
                text_area.feedback.value = '';
                feedback_is_sent = true;
            /*} catch (error) {
                console.error('Error:', error);
                alert('Произошла ошибка при отправке отзыва: ' + error);
            }*/
        }

        async function clearCharacter(){
            characterText("");
            DisableButtonState(true);
        }
        async function characterText(value) {
            document.getElementById(text_container_name).innerHTML = value;
            console.log("text of output is changed:'" + value +  "'" )
            if (value == ""){
                DisableButtonState(true);
            }
            else{
                DisableButtonState(false);
            }
        }
        function DisableButtonState(state){ //state - bool of state
            var clearButton = document.querySelector('button[name="clearCharacterButton"]');
                
            if (state == true) {
                clearButton.disabled = true;
                clearButton.classList.add('disabled');
            } else {
                clearButton.disabled = false;
                clearButton.classList.remove('disabled');
            }
        }
        
        window.onload = start;
    </script>
</body>
</html>